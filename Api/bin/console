#!/usr/bin/env php
<?php

declare(strict_types=1);

use Mush\Kernel;
use Symfony\Bundle\FrameworkBundle\Console\Application;

require_once dirname(__DIR__) . '/vendor/autoload_runtime.php';

return function (array $context, array $argv) {
    foreach ($argv as $i => $arg) {
        if (($arg === '--env' || $arg === '-e') && isset($argv[$i + 1])) {
            $context['APP_ENV'] = $_SERVER['APP_ENV'] = $_ENV['APP_ENV'] = $argv[$i + 1];
        }
        if ($arg === '--no-debug') {
            $context['APP_DEBUG'] = 0;
            $_SERVER['APP_DEBUG'] = $_ENV['APP_DEBUG'] = '0';
        }
    }

    $kernel = new Kernel(
        $context['APP_ENV'] ?? 'dev',
        (bool) ($context['APP_DEBUG'] ?? false)
    );

    return new Application($kernel);
};
