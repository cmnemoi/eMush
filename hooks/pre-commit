#!/bin/sh

run_local_commands() {
    # Run php-cs-fixer if .php files are modified
    if git diff --name-only --cached | grep -E '\.php$'; then
        echo 'Running php-cs-fixer'
        cd Api && php vendor/bin/php-cs-fixer fix && cd .. || return 1
    fi

    # Run eslint if .vue, .js, .ts, .scss, or .css files are modified
    if git diff --name-only --cached | grep -E '\.(vue|js|ts|scss|css)$'; then
        echo 'Running eslint'
        cd App && yarn lint && cd .. || return 1
    fi
    return 0
}

run_docker_commands() {
    # Run php-cs-fixer if .php files are modified
    if git diff --name-only --cached | grep -E '\.php$'; then
        echo 'Running php-cs-fixer'
        docker compose -f docker/docker-compose.yml exec -T -u dev mush_php php vendor/bin/php-cs-fixer fix || return 1
    fi

    # Run eslint if .vue, .js, .ts, .scss, or .css files are modified
    if git diff --name-only --cached | grep -E '\.(vue|js|ts|scss|css)$'; then
        echo 'Running eslint'
        docker compose -f docker/docker-compose.yml exec -T -u node mush_front yarn lint || return 1
    fi
    return 0
}

# Try local commands first
if command -v php >/dev/null 2>&1 && command -v yarn >/dev/null 2>&1; then
    run_local_commands || exit 1
else
    run_docker_commands || exit 1
fi
